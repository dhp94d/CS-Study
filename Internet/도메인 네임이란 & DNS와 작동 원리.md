# DNS 

**목표** : 도메인 이름이 무엇인지? 어떻게 작동하는지? 왜 중요한지?

Domain Name System의 약자



목차 

1. [요약부분(정의, 작동원리)](#-dns-요약)
2. Deep DNS(자세한 작동원리)

### DNS 요약

도메인 이름은 인터넷 인프라의 핵심부분! 인터넷에서 사용 가능한 모든 웹 서버에 사람이 읽을 수 있는 주소를 제공합니다!

- 읽을 수 있는 주소?

   인터넷에 연결도니 모든 컴퓨터는 IPv4 || IPv6와 같은 공용 IP주소를 통해 연결할 수 있음

  ```ex) 173.194.121.32``2027:0da8:8b73:0000:0000:8a2e:0370:1337```

  사람은 이 주소만을 가지고 웹 사이트가 제공하는 서비스를 파악하기 어려우며, 기억하기 또한 어렵습니다( 추후 변경 가능성 또한 있음)

  이와 같은 문제를 해결하기 위하여 사람이 읽을 수 있는 주소인 DNS가 탄생!



### DNS 요청 작동 원리 요약

1.  mozilla.org을 브라우저의 위치 표시줄에 입력
2. 브라우저는 이 도메인 이름으로 식별된 IP 주소를 이미 인식하는지( 로컬 DNS 캐시 사용) 확인 후 그렇다면 이름이 IP주소로 변환되고 브라우저는 웹 서버와 콘텐츠를 협상합니다.
3. 컴퓨터가 IP주소를 인식하고 있지 않다면(로컬 DNS캐시에 ip주소가 없음) DNS서버를 요청 합니다. 그 역할은 정확히 어떤 IP주소가 등록 된 각 도메인 이름과 일치하는지 컴퓨터에 알려줌
4. 이제 컴퓨터가 요청된 IP주소를 알고 있으므로 브라우저는 웹 서버와 콘텐츠를 협상할 수 있음

![image](https://user-images.githubusercontent.com/68668924/105484596-ec380c00-5cee-11eb-9595-50beda377fd1.png)





## 도메인 이름 구조

도메인 이름은 점으로 구분되고 오른쪽에서 왼쪽으로 읽는 여러부분으로 구서된 간단한 구조를 가지고 있습니다.

![image](https://user-images.githubusercontent.com/68668924/105484615-f0fcc000-5cee-11eb-80c8-1ded4935f175.png)

**TLD(Top level domain) **

 사용자에게 도메인 이름 뒤에 있는 서비스의 일반적인 목적을 알려줍니다. 

가장 일반적인 TLD(.com, .org, .net)들이 특정 기준을 충족하는 웹 서비스를 필요로 하지 않지만, 일부는 목적이 무엇인지 명확하게 알 수 있도록 일부 TLD에는 엄격한 정책을 적용합니다.

- 같은 지역 TLD를 .us, .fs 등으로 주어진 언어로 제공 또는 특정 국가에서 호스팅 할 필요가 있습니다
- .gov TLD는 정부 부서에서만 사용할 수 있습니다.
- .edu TLD는 교육 및 학술 기관에 의해 사용됩니다.

TLD는 최대 63자이지만 대부분 2~3자만 사용 TLD전체 목록은 [ICANN](https://www.icann.org/resources/pages/tlds-2012-02-25-en)에서 관리



**label (component라고도 불림)**

- 레이블은 TLD를 따릅니다. TLD 바로 앞에 있는 레이블은 SLD 라고도 합니다

- 도메인 바로 앞의 레이블을 SLD라고도 합니다.
- 레이블은 레이블길이| 레이블 문자열을 모두 포괄한 것을 레이블이라고합니다. 
- 레이블은 [a-zA-Z0-9\\-]로만 구성해야합니다.
- 도메인은 반드시 하나 이상의 레이블로 구성되며, 레이블 하나만으로 구성된 경우는 ""라는 비어있는 하나의  레이블 문자열만 갖는 경우이며 이것은 특수한 도메인 이름이 루트 도메인 이름입니다.
- DNS패킷에서는 하나 이상의 레이블을 연이어 나열하여 도메인 이름을 설정하는데,  .(dot)으로 구분



tip.루트레이블

FQDN(Fully Qualified Domain Name)

도메인 이름의 마지막에는 항상 루트레이블이 존재! ex) a.com 으로 끝난경우 사실상 a.com.이라고 보면 됩니다. 이렇게 루트 레이블까지 명시하여 표기한 DNS 표기 방식을 FQDN이라고 합니다.

FQDN 방식으로 표기된 도메인 이름은 인터넷 상에서 유일한 이름을 명확히 표현하는 역할을 합니다. 인증서 발급 신청 경우와 같이 표기하는 도메인 이름에 대해 아주 정확한 도메인 이름 정보가 필요할 때 DQDN방식으로 도메인 이름을 표기할 것을 요구합니다.





## DNS 총 정리

1. **DNS 주소 입력**

   - 컴퓨터와 기타 장치는 IP주소를 사용하여 통신하여 인터넷에서 서로를 식별함 ( 10.0.0.1, 192.168,1.0 등등)

   - 그러나 인간은 IP주소를 기억할 수 없으므로 단어를 사용함 (google, irs)

   - DNS는 두 가지를 하나로 모아 목적지로 안내합니다

     ![image](https://user-images.githubusercontent.com/68668924/105484628-f528dd80-5cee-11eb-86f7-e505da398bd9.png)  -> 216.58.210.142

   - 브라우저와 OS는 모두 캐시를 먼저 검색하여 해당 주소의 IP를 알고 있는지 확인합니다. 해당 주소가 없다면 resolver를 호출함

2. resolver(DNS Client 해결자,DNS 해석기, DNS변환기 , DNS resolver) 호출

    - 리졸버 서버는 일반적으로 ISP(인터넷 서비스 공급자) 입니다. 모든 리졸버는 루트 서버의 위치를 알아야합니다. 루트서버는 TLD서버의 위치를 알고 있으며 TLD는 최상위 도메인을 나타냅니다.

3. root 서버

    - 루트서버에서 해당 TLD서버인 (현재 co.kr) .co.kr 최상위 도메인 서버를 찾을 수 있는곳을 알려줍니다. 이때 리졸버는 이 정보를 저장하기 때문에 같은 문제를 루트에게 다시 묻지 않아도 됩니다.
    - 이 루트 서버는 현재 존재하는 13개의 루트 이름 서버 중 하나일 뿐입니다. 루트 서버는 DNS 계층 구조의 맨 위에 있으며 전 세계 흩어져 있고 12개의 독립 조직에서 운영합니다. 이름은 [letter] .root-servers.new이며 문자는 A-M 까지입니다. (ex a.root-severs.net) 그렇다고 전체 인터넷을 지원할 물리적 서버가 12개가 있다는 것은 아니며, 각 조직은 전 세계에 분산된 물리적 서버를 제공합니다.

4. TLD(현재 co.kr)

    - 최상위 도메인 TLD의 조정은 ICANN에 속합니다.
      - 1. 국가코드 TLD, 일반적으로 2자리 코드 ex) .JP , .FR
        2. 국제화 된 국가 코드 .yxp
        3. 일반 TLD: .NET .ORG .EDU 등 (일반적으로 3자 이상의 문자가 있는 TLD)
        4. 인프라 TLD: .ARPA, 주로 역방향 DNS 조회에 사용됩니다. (현재 우리가 하고 있는 것과 반대, ip주소로 DNS를 찾음)
        5. 오느날은 다양한 TLD가 생성되는중 .APP 등
    - CO.kr에서 도메인에 대한 권한이 있는 서버를 찾아줍니다.
    - (ex dnsimple.com을 찾는다는 가정 하에 현재 경우 내가 가진 유일한 것은 dnsimple.com에 대한 요청입니다. .COM TLD는 ns1.dnsimple.com이 IP 주소를 찾을 수있는 위치를 알려줄 수 있다고 알려줍니다)

5. ns1.dnsimple.com

    - 캐시된 값이 없는경우 도메인에 연결된 이름 서버가 여러개일 때 순서가 없는 이름 목록을 제공함, 이 떄 목록에서 이름 서버를 쿼리할 수 있습니다. 쿼리 결과 ip를 찾을 수 있습니다.

6. 과정

    1. 루트가 com서버를 찾을 수 있는 곳을 알려주었고
    2. TLD서버가 나에게 신뢰할 수 있는 이름 서버 주소를 제공하였습니다.
    3. 그런다음 신뢰할 수 있는 서버 주소에서 주소 IP를 제공하였습니다.

7. 이 과정을 거쳐 다시 주소를 입력해도 귀찮지 않도록 DNS 캐시를 저장합니다.



이때 의문! 리졸버가 dnsimple보다 ns1.simple을 먼저 찾을 수 있는 이유가 뭘까! dns는 오른쪽에서 왼쪽으로 읽음에도 불구하고!





tip. resovler

```출처:http://www.ktword.co.kr/abbr_view.php?m_temp1=1487
1. Resolver (해석기)

  ㅇ DNS 서버에 대한 엑세스를 수행하는 어플리케이션
     - 네임서버에 원하는 호스트에 대한 정보를 조회(질의)하고,
     - 그 응답으로부터 필요 정보를 추출하는 DNS 클라이언트용 프로그램

  ㅇ IP 주소와 호스트 이름 간을 서로 매핑시키기 위해,
     - 적어도 1 이상의 네임서버에 접근하여, 그 네임서버에 있는 정보를 사용 함


2. Resolver 특징

  ㅇ 일반적으로 유닉스에서 Resolver에 대한 구성 설정 화일
     - /etc/resolv.conf
     - 이 화일에는 디폴트 도메인과 네임서버 명칭 및 이의 IP 주소가 있음

  ㅇ 작고 간결한 라이브러리 루틴
     - 사실상, Resolver 소프트웨어는,
     - http, ftp, telnet 등에 연결 링킹되는 작고 간결한 라이브러리 루틴


3. Resolver 주요 기능

  ㅇ 네임서버에 질의를 보내고,
  ㅇ 그 응답(자원레코드 또는 에러)을 해석
  ㅇ 리졸버에 요청한 프로그램에 그 결과 정보를 되돌려줌
```

## 도메인 소유

도메인은 소유할 수 없습니다. 이는 사용되지 않는 도메인을 다른 사람이 다시 사용할 수 있도록 만들기 위함이며, DNS는 특정 기간을 사용할 수 있는 권리에 대해 값을 지불할 경우 사용할 수 있습니다. 

**사용 가능한 도메인 이름 찾기**

도메인 이름 등록 기관의 웹 사이트로 이동합니다. 대부분은 whois 서비스를 제공합니다. 또한 내장 쉘이 있는 시스템을 사용하는 경우 whois mozilla.org 와 같이 입력하면 사용 유무를 알 수 있습니다.



**DNS 새로고침**

DNS 데이터베이스는 전 세계의 모든 DNS 서버에 저장되며 이러한 모든 서버는 "authoritative name servers" 또는 "“top-level DNS servers" 라고 하는 몇 가지 특수 서버를 참조합니다. 

등록 대행자가 주어진 도메인에 대한 정보를 생성하거나 업데이트 하면, 모든 DNS 데이터 베이스에서 정보를 새로 고쳐야하며 이 때 DNS서버에서 권한 있는 서버를 쿼리하고 여기에서 업데이트 도니 정보를 가져옵니다. 이로인해 DNS 서버가 최신 정보를 가져오는데 약간의 시간이 걸립니다.



출처

- https://developer.mozilla.org
- https://howdns.works

- https://dnssec.tistory.com/27
