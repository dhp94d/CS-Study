# 클로저

클로저는 함수와 그 함수가 선언된 렉시컬 환경과의 조합이다.

 함수가 정의된 환경과 호출되는 위치는 다를 수 있다. 따라서 렉시컬 스코프가 가능하려면 함수는 자신이 호출되는 환경과는 상관없이 자신이 정의된 환경, 즉 상위 스코프를 기억해야한다 이를 위해 함수는 자신의 내부슬롯[[Environment]]에 자신이 정의된 환경, 즉 상위 스코프의 참조를 저장한다.

즉 함수 정의가 평가되어 함수 객체를 생성할 때 정의된 환경에 의해 결정된 상위 스코프의 참조를 함수 객체 자신의 내부슬롯에 저장한다. 이때 자신의 내부슬롯에 정장된 상위 스코프의 참조는 현재 실행 중인 실행 컨텍스트의 렉시컬 환경을 가리킨다.



## 클로저의 활용

클로저는 상태를 안전하게 변경하고 유지하기 위해 사용한다. 상태가 의도치 않게 변경되지 않도록 상태를 안전하게 은닉하고 특정 함수에게만 상태 변경을 허용하기 위해서 사용한다.

```
let num = 9;

const increase = function() {
	return ++num;
};
console.log(increase()); // 1
console.log(increase()); // 2
console.log(increase()); // 3
```

위 코드느는 오류를 발생시킬 가능성을 내포하고 있는 좋지 않은 코드 카운트 상태가 호출되기 전까지 변경되지 않아야 하며, 이를위해 카운트 사태는 increase 함수만이 변경할 수 있어야 하기 때문

하지만 카운트 상태는 전역 변수를 통해 관리되고 있기 때문에 언제든지 누구나 접근할 수 있다. 이는 의도치 않게 상태가 변경될 수 있다는 것을 의미한다.

```
const increase = (function () {
	let num = 0;
	return function () {
		return ++num;
	};
}());
```

위 코드가 실행되면 즉시 실행함수가 호출되고 즉시 실행 함수가 반환한 함수 가 increase 변수에 할당된다. increase변수에 할당된 함수는 자신이 정의된 위치에 의해 결정된 상위 스코프인 즉시 실행 함수의 렉시컬 환경을 기억하는 클로저다.

즉시 실행 함수는 호출된 이후 소멸되지만 즉시 실행 함수가 반환한 클로저는 increase 변수에 할당되어 호출된다. 이때 즉시 실행 함수가 반환한 클로저는 자신이 정의된 위치에 의해 결정된 상위 스코프인 즉시 실행 함수의 렉시컬 환경을 기억하고있다. 따라서 즉시 실행 함수가 반환한 클로저는 카운터 상태를 유지하기 위한 자유 변수 num을 언제 어디서 호출하든지 참조하고 변경할 수 있다.

즉시 실행 함수는 한 번만 실행되므로 increase가 호출될 때마다 num 변수가 재차 초기화될 일은 없을 것이다. 또한 num 변수는 외부에서 직접 접근할 수 없는 변수이므로  안정적이다. 이처럼 클로저 상태가 의도치 않게 변경되지 않도록 안전하게 은닉하고 특정 함수에게만 상태 변경을 허용하여 상태를 안전하게 변경하고 유지하기 위해 사용한다.

